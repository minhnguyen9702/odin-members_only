<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Members Only</title>
  </head>
  <body>
    <% if (locals.user) { %>
    <h1>WELCOME BACK <%= locals.user.username %></h1>
    <a href="/member-status">CHANGE MEMBERSHIP STATUS</a>
    <a href="/log-in/log-out">LOG OUT</a>
    <h2>CREATE A NEW MESSAGE</h2>
    <form action="/message/add" method="POST">
      <label for="title">Title:</label>
      <input type="text" id="title" name="title" required />

      <label for="text">Message:</label>
      <textarea id="text" name="text" required></textarea>

      <button type="submit">Post Message</button>
    </form>

    <% if (errorMessage.length) { %>
    <p><%= errorMessage[0] %></p>
    <% } %>

    <h2>Messages</h2>
    <% if (messages.length) { %>
      <ul>
        <% messages.forEach((msg) => { %>
          <li>
            <strong><%= msg.title %></strong>: <%= msg.text %>
    
            <% if (locals.user && locals.user.membership_status) { %>
              <br>
              <small>
                By <%= msg.username %> on <%= new Date(msg.created_at).toLocaleString("en-US", { 
                  year: "numeric", 
                  month: "long", 
                  day: "numeric", 
                  hour: "2-digit", 
                  minute: "2-digit", 
                  second: "2-digit", 
                  hour12: false // Set to true for AM/PM format
                }) %>
              </small>
            <% } %>

            <% if (user && user.admin_status) { %>
              <form action="/message/delete/<%= msg.id %>" method="POST">
                <button type="submit">‚ùå Delete</button>
              </form>
            <% } %>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>No messages yet.</p>
    <% } %>
    
    <% } else { %>
    <h1>Please Login</h1>
    <form action="/log-in" method="POST">
      <label for="username">Username</label>
      <input id="username" name="username" placeholder="username" type="text" />
      <label for="password">Password</label>
      <input id="password" name="password" type="password" />
      <button>Log In</button>
    </form>
    <a href="/sign-up">Don't have an account? Please sign up.</a>
    <% } %> <% if (errorMessage.length) { %>
    <p><%= errorMessage[0] %></p>
    <% } %>
  </body>
</html>
